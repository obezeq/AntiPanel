<article
  class="order-ready"
  [class.order-ready--with-target]="hasTarget()"
  role="region"
  aria-labelledby="order-ready-heading"
  aria-live="polite"
>
  <!-- Header: Flash icon + ORDER READY + Match percentage -->
  <header class="order-ready__header">
    <div class="order-ready__title">
      <ng-icon class="order-ready__flash" name="iconoirFlash" aria-hidden="true" />
      <h2 id="order-ready-heading" class="order-ready__heading">ORDER READY</h2>
    </div>
    <p class="order-ready__match" [attr.aria-label]="'Match confidence ' + data().matchPercentage + ' percent'">
      {{ data().matchPercentage }}% MATCH
    </p>
  </header>

  <!-- Service info card -->
  <section class="order-ready__service">
    <figure class="order-ready__service-icon" aria-hidden="true">
      <ng-icon [name]="data().service.icon" />
    </figure>
    <div class="order-ready__service-info">
      <h3 class="order-ready__service-name">
        {{ data().service.platform }} {{ data().service.type }}
      </h3>
      <p class="order-ready__service-details">
        <span>{{ data().service.quality }}</span>
        <span>{{ data().service.speed }}</span>
      </p>
    </div>
    <div class="order-ready__service-amount">
      @if (isEditingQuantity()) {
        <input
          #quantityInput
          type="text"
          inputmode="numeric"
          class="order-ready__quantity-input"
          [value]="data().quantity"
          aria-label="Edit quantity - supports k/m suffixes"
          (blur)="onQuantityBlur($event)"
          (keydown.enter)="onQuantitySubmit($event)"
          (keydown.escape)="cancelQuantityEdit()"
        />
      } @else {
        <button
          type="button"
          class="order-ready__quantity order-ready__quantity--editable"
          aria-label="Click to edit quantity"
          (click)="startQuantityEdit()"
        >{{ data().quantity }}</button>
      }
      <p class="order-ready__price">{{ data().price }}</p>
    </div>
  </section>

  <!-- Validation error message -->
  @if (hasValidationError()) {
    <aside class="order-ready__validation-error" role="alert" aria-live="polite">
      <svg
        class="order-ready__error-icon"
        width="16"
        height="16"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        aria-hidden="true"
      >
        <circle cx="12" cy="12" r="10" />
        <line x1="12" y1="8" x2="12" y2="12" />
        <line x1="12" y1="16" x2="12.01" y2="16" />
      </svg>
      <span>{{ validationMessage() }}</span>
    </aside>
  }

  <!-- Target URL section - always visible -->
  <section class="order-ready__target">
    <h4 class="order-ready__target-label">TARGET URL</h4>
    @if (isEditingTarget()) {
      <input
        #targetInput
        type="text"
        class="order-ready__target-input"
        [value]="data().target ?? ''"
        placeholder="@username or URL"
        aria-label="Enter target username or URL"
        (blur)="onTargetBlur($event)"
        (keydown.enter)="onTargetSubmit($event)"
        (keydown.escape)="cancelTargetEdit()"
      />
    } @else {
      <button
        type="button"
        class="order-ready__target-value order-ready__target-value--editable"
        [class.order-ready__target-value--placeholder]="!hasTarget()"
        [attr.aria-label]="hasTarget() ? 'Click to edit target' : 'Click to add target'"
        (click)="startTargetEdit()"
      >{{ hasTarget() ? data().target : 'Add @username or URL' }}</button>
    }
  </section>

  <!-- Explore buttons -->
  <section class="order-ready__explore">
    <button
      type="button"
      class="order-ready__explore-btn"
      aria-label="Explore more services"
      (click)="exploreMore.emit()"
    >
      <ng-icon class="order-ready__search-icon" name="matSearch" aria-hidden="true" />
      <span>EXPLORE MORE</span>
    </button>
    <button
      type="button"
      class="order-ready__explore-btn"
      [attr.aria-label]="'View more ' + platformName() + ' services'"
      (click)="morePlatform.emit(platformName())"
    >
      <span>MORE {{ platformName() }}</span>
    </button>
  </section>

  <!-- Place Order button -->
  <button
    type="button"
    class="order-ready__place-order"
    [class.order-ready__place-order--disabled]="disabled()"
    [disabled]="disabled()"
    [attr.aria-label]="'Place order for ' + data().quantity + ' ' + data().service.platform + ' ' + data().service.type + ' at ' + data().price"
    [attr.aria-disabled]="disabled()"
    (click)="placeOrder.emit(data())"
  >
    <span class="order-ready__currency">$</span>
    <span class="order-ready__place-text">PLACE ORDER</span>
    <span class="order-ready__separator">â€¢</span>
    <span class="order-ready__total">{{ data().price }}</span>
    <ng-icon class="order-ready__arrow" name="matArrowForward" aria-hidden="true" />
  </button>
</article>
