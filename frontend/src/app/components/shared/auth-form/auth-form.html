<!-- Header fuera del form -->
<header class="auth-form__header">
  <h1 class="auth-form__title">{{ headerTitle() }}</h1>
  <p class="auth-form__subtitle">{{ headerSubtitle() }}</p>
</header>

<form
  class="auth-form"
  [formGroup]="form"
  (ngSubmit)="onSubmit()"
  novalidate
>
  <fieldset class="auth-form__fieldset">
    <!-- Legend oculto visualmente pero presente para accesibilidad -->
    <legend class="auth-form__legend">{{ formTitle() }}</legend>

    @if (serverError()) {
      <p class="auth-form__server-error" role="alert">
        {{ serverError() }}
      </p>
    }

    <section class="auth-form__fields">
      <app-form-input
        label="Email"
        type="email"
        placeholder="EMAIL"
        autocomplete="email"
        [required]="true"
        [hideLabel]="true"
        [errorMessage]="emailError()"
        formControlName="email"
      />

      <app-form-input
        label="Password"
        type="password"
        placeholder="PASSWORD"
        [autocomplete]="isRegisterMode() ? 'new-password' : 'current-password'"
        [required]="true"
        [hideLabel]="true"
        [errorMessage]="passwordError()"
        formControlName="password"
      />

      @if (isRegisterMode()) {
        <app-form-input
          label="Confirm Password"
          type="password"
          placeholder="CONFIRM PASSWORD"
          autocomplete="new-password"
          [required]="true"
          [hideLabel]="true"
          [errorMessage]="confirmPasswordError()"
          formControlName="confirmPassword"
        />
      }
    </section>

    <section class="auth-form__actions">
      <button
        type="submit"
        class="auth-form__submit"
        [disabled]="loading()"
      >
        @if (loading()) {
          <span class="auth-form__spinner" aria-hidden="true"></span>
          <span>Processing...</span>
        } @else {
          <ng-icon class="auth-form__submit-icon" name="matArrowForward" size="32" aria-hidden="true" />
          <span>{{ submitButtonText() }}</span>
        }
      </button>

      <p class="auth-form__switch">
        <span class="auth-form__switch-text">{{ switchModeText() }}</span>
        <a [routerLink]="switchModeRoute()" class="auth-form__switch-link">
          {{ switchModeLink() }}
        </a>
      </p>
    </section>
  </fieldset>
</form>
