<section
  id="services-section"
  class="services-section"
  [class.services-section--expanded]="isExpanded()"
  aria-labelledby="services-title"
>
  <!-- Error Message -->
  @if (errorMessage()) {
    <aside class="services-section__error" role="alert">
      <p>{{ errorMessage() }}</p>
    </aside>
  }

  <!-- Platform Grid View -->
  @if (!isExpanded()) {
    <!-- Section Header -->
    <app-dashboard-section-header
      title="SERVICES"
      titleId="services-title"
      subtitle="Choose your platform to see all available services"
    />

    <!-- Loading State for Categories -->
    @if (isLoadingCategories()) {
      <div class="services-section__loading" role="status" aria-label="Loading platforms">
        <svg class="services-section__spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <circle cx="12" cy="12" r="10" stroke-dasharray="60" stroke-dashoffset="20" />
        </svg>
        <span class="services-section__loading-text">Loading platforms...</span>
      </div>
    }

    <!-- Platform Cards Grid -->
    @if (!isLoadingCategories() && categories().length > 0) {
      <div class="services-section__grid">
        @for (category of categories(); track category.id) {
          <app-service-card
            [service]="mapCategoryToServiceCardData(category)"
            (cardClick)="onPlatformClick($event)"
          />
        }
      </div>
    }

    <!-- Empty State -->
    @if (!isLoadingCategories() && categories().length === 0 && !errorMessage()) {
      <div class="services-section__empty" role="status">
        <p>No platforms available at this time.</p>
      </div>
    }
  }

  <!-- Expanded Services View -->
  @if (isExpanded() && selectedCategory()) {
    <!-- Expanded Header with Back Button -->
    <header class="services-section__expanded-header">
      <button
        type="button"
        class="services-section__back-btn"
        aria-label="Back to platforms"
        (click)="onBackClick()"
        (keydown)="onBackKeydown($event)"
      >
        <ng-icon name="matArrowBack" size="24" aria-hidden="true" />
      </button>

      <h2 class="services-section__expanded-title">
        {{ selectedCategory()!.name.toUpperCase() }}
      </h2>

      <span class="services-section__service-count">
        @if (isLoadingServices()) {
          Loading...
        } @else {
          {{ categoryServices().length }} SERVICES
        }
      </span>
    </header>

    <!-- Loading State for Services -->
    @if (isLoadingServices()) {
      <div class="services-section__loading" role="status" aria-label="Loading services">
        <svg class="services-section__spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <circle cx="12" cy="12" r="10" stroke-dasharray="60" stroke-dashoffset="20" />
        </svg>
        <span class="services-section__loading-text">Loading services...</span>
      </div>
    }

    <!-- Services List -->
    @if (!isLoadingServices() && categoryServices().length > 0) {
      <div class="services-section__services-list">
        @for (service of categoryServices(); track service.id) {
          <app-service-item-card
            [service]="mapServiceToItemData(service)"
            (quickOrder)="onQuickOrder($event)"
          />
        }
      </div>
    }

    <!-- Empty State for Services -->
    @if (!isLoadingServices() && categoryServices().length === 0 && !errorMessage()) {
      <div class="services-section__empty" role="status">
        <p>No services available for this platform at this time.</p>
      </div>
    }
  }
</section>
